@using Microsoft.AspNetCore.Identity
@model TaskManagement.Models.Project
@inject UserManager<ApplicationUser> UserManager

<div class="card project-card shadow-sm h-100 border-0 rounded-3">
    <div class="card-body d-flex flex-column p-4">

        <!-- Header Card: Data si Editare -->
        <div class="d-flex justify-content-between align-items-center mb-3">
            <span class="badge bg-light text-secondary border">
                <i class="bi bi-calendar3"></i> @Model?.CreatedDate.ToString("dd MMM yyyy")
            </span>

            <!-- Buton Editare (Doar daca e organizator - logica o poti pune in controller sau aici) -->
            <a asp-controller="Projects"
               asp-action="Edit"
               asp-route-id="@Model?.Id"
               class="text-muted text-decoration-none px-2"
               title="Setări Proiect">
                <i class="bi bi-gear-fill"></i>
            </a>
        </div>

        <!-- Titlu -->
        <h4 class="card-title fw-bold text-dark mb-2">
            @Model?.Title
        </h4>

        <!-- Descriere trunchiata -->
        <p class="card-text text-muted flex-grow-1" style="font-size: 0.95rem; line-height: 1.5;">
            @{
                var desc = string.IsNullOrWhiteSpace(Model?.Description) ? "Fără descriere disponibilă." : Model.Description;
                var maxChars = 120;
                if (desc.Length > maxChars)
                {
                    @desc.Substring(0, maxChars)
            
                    <span class="text-primary">...</span>
                }
                else
                {
                    @desc
                }
            }
        </p>

        <!-- Divider subtil -->
        <hr class="text-muted opacity-25 my-3">

        <!-- Footer Card: Organizator si Buton -->
        <div class="d-flex justify-content-between align-items-center">

            <!-- Avatar Organizator -->
            @{
                var userId = Model.OrganizerId;
            
                <a asp-controller="Users" asp-action="UserProfile" asp-route-id=@userId class="nav-link">
            <div class="d-flex align-items-center" title="Organizator: @Model?.Organizer?.Email">
                @{
                    // Luam prima litera din Nume sau Email pentru avatar
                    var initial = "U";
                    if (Model?.Organizer?.FirstName != null)
                        initial = Model.Organizer.FirstName.Substring(0, 1).ToUpper();
                    else if (Model?.Organizer?.Email != null)
                        initial = Model.Organizer.Email.Substring(0, 1).ToUpper();
                }
                <div class="organizer-avatar me-2" title="@Model?.Organizer?.Email">
                    @initial
                </div>
                <div class="small text-muted d-none d-sm-block">
                    <span style="font-size: 0.8rem">Organizator</span><br>
                    <span class="fw-bold text-dark">@Model?.Organizer?.FirstName</span>
                </div>
            </div>
            </a>
            }

            <!-- Buton Deschide -->
            <a asp-controller="Board"
               asp-action="Index"
               asp-route-id="@Model?.Id"
               class="btn btn-outline-primary btn-sm rounded-pill px-4 fw-bold">
                Deschide <i class="bi bi-arrow-right"></i>
            </a>
        </div>
    </div>
</div>